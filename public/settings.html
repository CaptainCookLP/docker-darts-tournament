<!doctype html>
<html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Settings – Autodarts</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root { --brand:#fe7d19; --bg:#262629; --fg:#ffffff; --muted:#bfbfc4; --card:#2e2e33; --ok:#2ecc71; --warn:#f1c40f; --info:#3498db; --bad:#e74c3c; }
*{box-sizing:border-box}
body{ margin:0; background:var(--bg); color:var(--fg); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; }
a{ color:var(--fg); text-decoration:none; opacity:.9 }
a:hover{ opacity:1 }
header{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #3a3a3f; background:#202024; position:sticky; top:0; z-index:2}
.nav{ display:flex; gap:12px; }
.brand{ display:flex; align-items:center; gap:10px }
.logo{width:12px; height:12px; border-radius:50%; background:var(--brand); box-shadow:0 0 0 6px rgba(254,125,25,.2)}
h1{font-size:18px; margin:0}
main{ padding:16px }
.card{ background:var(--card); border:1px solid #3a3a3f; border-radius:14px; padding:16px }
h2{margin:0 0 10px 0; font-size:16px}
input,select,textarea,button { background:#1f1f22; color:var(--fg); border:1px solid #3a3a3f; border-radius:10px; padding:10px; }
button{ cursor:pointer; font-weight:600 }
button.primary{ background:var(--brand); border-color:var(--brand); color:#000 }
.small{ font-size:12px; color:var(--muted) }
.row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
.stack{ display:grid; gap:10px }
.badge{ padding:2px 8px; border-radius:999px; font-size:11px; font-weight:700 }
.status-pending{background:#444; color:#eee}
.status-assigned{background:var(--info); color:#000}
.status-running{background:var(--ok); color:#000}
.status-done{background:var(--bad); color:#fff}
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
</style>
</head><body>
<header>
  <div class="brand"><div class="logo"></div><h1>Autodarts – Settings</h1></div>
  <nav class="nav">
    <a href="/">Dashboard</a>
    <a href="/bracket">Bracket</a>
    <a href="/ws-log">WS Log</a>
    <span class="small">v0.3</span>
  </nav>
</header>
<main>
  <div class="row">
    <section class="card">
      <h2>Turnier-Einstellungen</h2>
      <div class="stack">
        <label>Modus
          <select id="mode">
            <option value="single-elim">Single Elimination</option>
            <option value="double-elim" disabled>Double Elimination (bald)</option>
          </select>
        </label>
        <label>Standard-Name <input id="defaultName" placeholder="Turniername"></label>
        <div class="row">
          <label>X01 Base <input id="base" type="number" value="501"></label>
          <label>Bull <select id="bull"><option>25/50</option><option>50/50</option></select></label>
          <label>In <select id="in"><option>Straight</option><option>Double</option><option>Master</option></select></label>
          <label>Out <select id="out"><option>Straight</option><option selected>Double</option><option>Master</option></select></label>
        </div>
        <h3 class="small">Formate pro Runde (Legs/Set & Sets zum Sieg)</h3>
        <div class="row">
          <label>R1 Legs/Set <input id="r1lps" type="number"></label>
          <label>R1 Sets <input id="r1stw" type="number"></label>
          <label>R2 Legs/Set <input id="r2lps" type="number"></label>
          <label>R2 Sets <input id="r2stw" type="number"></label>
          <label>R3 Legs/Set <input id="r3lps" type="number"></label>
          <label>R3 Sets <input id="r3stw" type="number"></label>
          <label>R4 Legs/Set <input id="r4lps" type="number"></label>
          <label>R4 Sets <input id="r4stw" type="number"></label>
          <label>R5 Legs/Set (Bronze) <input id="r5lps" type="number"></label>
          <label>R5 Sets (Bronze) <input id="r5stw" type="number"></label>
        </div>
        <div>
          <button id="save" class="primary">Speichern</button>
          <span id="status" class="small"></span>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Boards online</h2>
      <div class="small">Agenten verbinden sich via <span class="mono">ws(s)://HOST:PORT/agents-raw</span></div>
      <table style="width:100%;margin-top:10px;border-collapse:collapse;font-size:14px">
        <thead><tr><th style="text-align:left">Agent ID</th><th style="text-align:left">Label</th><th>Status</th></tr></thead>
        <tbody id="agents"></tbody>
      </table>
    </section>
  </div>
</main>
<script>
async function load(){{
  const s = await fetch('/api/settings').then(r=>r.json());
  document.getElementById('mode').value = s.mode || 'single-elim';
  document.getElementById('defaultName').value = s.defaults?.name || 'Vereins-Cup';
  document.getElementById('base').value = s.defaults?.x01?.base || 501;
  document.getElementById('bull').value = s.defaults?.x01?.bull || '25/50';
  document.getElementById('in').value = s.defaults?.x01?.in || 'Straight';
  document.getElementById('out').value = s.defaults?.x01?.out || 'Double';
  const fr = s.defaults?.formatsPerRound || {{} };
  function g(r,k,d){{ return (fr[r] && fr[r][k]) || d; }}
  r1lps.value=g(1,'legsPerSet',3); r1stw.value=g(1,'setsToWin',2);
  r2lps.value=g(2,'legsPerSet',3); r2stw.value=g(2,'setsToWin',2);
  r3lps.value=g(3,'legsPerSet',3); r3stw.value=g(3,'setsToWin',2);
  r4lps.value=g(4,'legsPerSet',5); r4stw.value=g(4,'setsToWin',3);
  r5lps.value=g(5,'legsPerSet',3); r5stw.value=g(5,'setsToWin',2);

  const agents = await fetch('/api/agents').then(r=>r.json());
  renderAgents(agents);
}}
function renderAgents(list){{
  const tbody = document.getElementById('agents'); tbody.innerHTML='';
  list.forEach(a=>{{
    const tr = document.createElement('tr');
    tr.innerHTML = '<td class="mono">'+a.agentId+'</td><td>'+ (a.label||'') +'</td><td>'+ (a.busy?'busy':'idle') +'</td>';
    tbody.appendChild(tr);
  }});
}}
async function save(){{
  const payload = {{
    mode: document.getElementById('mode').value,
    defaults: {{
      name: document.getElementById('defaultName').value || 'Vereins-Cup',
      x01: {{
        base: +document.getElementById('base').value || 501,
        bull: document.getElementById('bull').value,
        in: document.getElementById('in').value,
        out: document.getElementById('out').value
      }},
      formatsPerRound: {{
        1:{{legsPerSet:+r1lps.value, setsToWin:+r1stw.value}},
        2:{{legsPerSet:+r2lps.value, setsToWin:+r2stw.value}},
        3:{{legsPerSet:+r3lps.value, setsToWin:+r3stw.value}},
        4:{{legsPerSet:+r4lps.value, setsToWin:+r4stw.value}},
        5:{{legsPerSet:+r5lps.value, setsToWin:+r5stw.value}}
      }}
    }}
  }};
  await fetch('/api/settings', {{method:'POST', headers:{{'content-type':'application/json'}}, body: JSON.stringify(payload)}});
  const el = document.getElementById('status'); el.textContent='Gespeichert ✓'; setTimeout(()=>el.textContent='',1000);
  load();
}}
document.getElementById('save').addEventListener('click', save);
load();
</script>
</body></html>
